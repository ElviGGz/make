#!/bin/bash

.PHONY: all clean help variables

REF_FILES = $(wildcard references/*.fa*)

PAC = $(patsubst references/%, %.pac, $(REF_FILES))
AMB = $(patsubst references/%, %.amb, $(REF_FILES))
ANN = $(patsubst references/%, %.ann, $(REF_FILES))
BTW = $(patsubst references/%, %.btw, $(REF_FILES))
SA = $(patsubst references/%, %.sa, $(REF_FILES))

## all: This targets make all the indexes and keep each one in their respectives folders.
all: $(PAC) $(AMB) $(ANN) $(BTW) $(SA)

## This target is the main function of the programme
%.amb %.pac %.ann %.btw %.sa : references/*.fa*
	@echo "in process with " $@
	mkdir index/$*
	sbatch --partition=research.q --output=$*.slurm --wrap="bwa index -p index/$*/$* references/$*"
	@echo  "DONE with " $@

# Variables: This is the way to check the names of the files are correct
variables:
	@echo "REF_FILES: " $(REF_FILES)
	@echo "INDEXES : " $(PAC) $(AMB) $(ANN) $(BTW) $(SA)

## clean: will remove all index files generated by BWA in the references/ directory
clean:
	@ rm -r index/*

help: makefile
	@ sed -n "s/^##//p" $<








